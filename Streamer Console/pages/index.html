<!DOCTYPE html>
<html>
<head>
    <title>Game Testing</title>
</head>
<body>
    <label for="playerId">Player ID:</label>
    <input type="text" id="playerId">
    <button onclick="addPlayer()">join game</button><br>

    <input type="text" id="danmu" placeholder="danmu">
    <button class="button" onclick="sendDanmu()">Send Danmu</button><br>

    <button class="button" onclick="like()">Thumbs up</button><br>

    <button class="button" onclick="gift()">Send Gift</button><br>

    <button class="button" onclick="addBot()">Add Bot</button><br>

    <div id="ids"></div>



    <script>

        // Create a new WebSocket connection
        var ws = new WebSocket('ws://54.159.171.208:8080/testGame');

        function addPlayer() {
            var playerId = document.getElementById("playerId").value;
            var data = { "action": "addPlayer", "playerId": playerId };
            ws.send(JSON.stringify(data));
        }


    /*    function addPlayer() {
            var playerId = document.getElementById("playerId").value;
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    alert("玩家已成功加入游戏！");
                }
            };
            xhttp.open("POST", "http://localhost:3000/testGame", true);
            xhttp.setRequestHeader("Content-type", "application/json");
            var data = { "playerId": playerId };
            xhttp.send(JSON.stringify(data));
        }
*/

        function like() {
            // 向Unity发送该名玩家的模拟点赞操作
            var playerId = document.getElementById("playerId").value;
            var data = { "action": "like", "playerId": playerId };
            ws.send(JSON.stringify(data));
        }

        function sendDanmu() {
            // 在输入后向Unity发送该名玩家的模拟弹幕输入
            var playerId = document.getElementById("playerId").value;
            var danmu = document.getElementById("danmu").value;
            var data = { "action": "sendDanmu", "playerId": playerId, "danmu": danmu };
            ws.send(JSON.stringify(data));
        }

        function gift() {
            // 向Unity发送该名玩家的模拟礼物种类和数量
            var playerId = document.getElementById("playerId").value;
            // Modify this line to include gift type and quantity if necessary
            var data = { "action": "gift", "playerId": playerId };
            ws.send(JSON.stringify(data));
        }

        function addBot() {
            // 向Unity发送一名随机id的玩家的Join弹幕
            var playerId = 'Bot' + Math.floor(Math.random() * 1000); // Generate a random ID for bot
            var data = { "action": "addBot", "playerId": playerId };
            ws.send(JSON.stringify(data));
        }

        ws.onopen = function() {
            // Request player IDs from Unity
            ws.send("getPlayers");
        };

        ws.onmessage = function(event) {
            // Handle the data received from Unity
            var data = JSON.parse(event.data);
            var ids = data.map(player => player.playerId);
            document.getElementById('ids').innerHTML = ids.join('<br>');
        };


    </script>

    <style>
        .button {
            margin-right: 10px; /* Adjust the margin value to control the spacing */
        }
    </style>

</body>
</html>
